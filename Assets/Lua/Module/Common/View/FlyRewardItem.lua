---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by likai.
--- DateTime: 2023/4/27 16:21
--- 飞翔的合成产品

---@class FlyRewardItem:LuaObj
---@field New fun(anchorPos:Vector2, endAnchorPos:Vector2, pic:string, num:number, index:number, callBack:function, boom:boolean):FlyRewardItem
local FlyRewardItem = class("FlyRewardItem",LuaObj)

local HORIZONTAL_OFFSET = Vector2.New(0, 0)
FlyRewardItem.NO_ADD_NUM = 20
function FlyRewardItem:Ctor(anchorPos, endAnchorPos, path, num, index, callBack, noBoom)
    --print("你妹啊~", path)
    self.num = num or 1
    FlyRewardItem.super.Ctor(self, "Prefabs/Common/FlyItem.prefab", nil, Constants.LAYER_UI_TOP)

    self.icon = GetComponent.Image(self.gameObject)
    self.rt = GetComponent.RectTransform(self.gameObject)
    self.callBack = callBack

    self.icon.sprite = Res.LoadSprite(path)
    self.icon:SetNativeSize()

    local seq = DOTween.Sequence()
    ---爆炸效果
    if noBoom ~= true then
        self.rt.anchoredPosition = anchorPos + HORIZONTAL_OFFSET + Vector3.New(0, 40)
        local center = self.rt.anchoredPosition + Vector2.New(0,40)
        local dur = 0.4
        if num >= FlyRewardItem.NO_ADD_NUM then
            index = 0
        end

        local randomGroundX = Happy.Random(10,320) - 160
        local randomGroundY = 60 + 1 * (Happy.Random(0,40) - 20)
        local pos = Vector2.New(center.x + randomGroundX,
                center.y - randomGroundY)
        seq:Append(self.rt:DOJumpAnchorPos(pos, 120, 1, dur))
        seq:Join(self.rt:DOScale(1.2, dur):SetEase(DOTWEEN_EASE.OutCubic))
        seq:AppendInterval(Happy.Random(0,0.5))
    else
        self.rt.anchoredPosition = anchorPos + HORIZONTAL_OFFSET
        local pos = anchorPos + Vector3.New(0, 80) + HORIZONTAL_OFFSET
        seq:Append(self.rt:DOAnchorPos(pos, 0.3))
        seq:AppendInterval(0.5)
    end

    if endAnchorPos ~= nil then
        seq:Append(self.rt:DOAnchorPos(endAnchorPos, 0.3):SetEase(DOTWEEN_EASE.InQuint))
        seq:AppendCallback(function()
            if self.callBack then
                local callBack = self.callBack
                self.callBack = nil
                callBack()
            end
        end)
        seq:Append(self.icon:DOFade(0, 0.15))
        seq:AppendCallback(happyCall(self, self.Recycle))
    end

end

function FlyRewardItem:Recycle()
    Happy.SetColorAlpha(self.icon, 1)
    FlyRewardItem.super.Recycle(self)
end

return FlyRewardItem