---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by likai.
--- DateTime: 2024/1/15 16:16
--- 引导列表Item
---@class StoryListItem:LuaObj
---@field New fun(name:string,parent:UnityEngine.Transform,isRunning:boolean):StoryListItem
local StoryListItem = class("StoryListItem", LuaObj)

local NORMAL_COLOR=Color.New(160/255,219/255,1,1)
local RUNNING_COLOR=Color.New(160/255,1,219/255,1)
function StoryListItem:Ctor(name, parent, isRunning)
    StoryListItem.super.Ctor(self, "Prefabs/Console/StoryListItem.prefab", nil, parent)

    self.bgImg = GetComponent.Image(self.gameObject)
    self.bgImg.color = NORMAL_COLOR

    self.nameLb = GetComponent.TextMeshProUGUI(self.transform:Find("nameLb").gameObject)
    self.nameLb.text = name

    self.progressRt = GetComponent.RectTransform(self.transform:Find("progress").gameObject)
    self.progressImg = GetComponent.Image(self.progressRt.gameObject)
    self.progressRt.anchoredPosition = Vector2.New(-430,0)
    if isRunning ~= true then
        Happy.BtnClickDownUP(self.gameObject, function()
            if isnull(self.progressRt) ~= true then
                self.progressRt:DOKill()
                self.progressImg:DOKill()
                self.progressImg:DOFade(0,0.2)
                self.progressRt:DOAnchorPosX(-430, 0.2)
            end
        end, function()
            self.progressImg:DOFade(1,2):SetEase(DOTWEEN_EASE.Linear)
            self.progressRt:DOAnchorPosX(0,2):SetEase(DOTWEEN_EASE.Linear):OnComplete(function()
                DelayedFrameCall(function()
                    StoryManager.ResetRecordTo(self.nameLb.text)
                    StoryManager.curStoryName = self.nameLb.text
                    require("Module.Common.View.ConsoleView").instance.storyList:Hide()
                    --DelayedCall(1, Game.Relaunch)
                    --DelayedFrameCall(Game.Relaunch)
                end)
            end)
        end, true)
    else
        self:SetRunning()
    end
end

function StoryListItem:SetRunning()
    self.isRunning = true
    self.bgImg.color = RUNNING_COLOR
end

return StoryListItem