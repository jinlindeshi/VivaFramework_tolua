---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by sunshuo.
--- DateTime: 2023/2/2 17:51
--- UI管理器

---@class UIManager
local UIMgr = {}

---UI层级名称
UILayerName = {}
UILayerName.scene = "Scene"
UILayerName.ui = "UI"
UILayerName.panel = "Panel"
UILayerName.uiTop = "UITop"
UILayerName.alert = "Alert"
UILayerName.guide = "Guide"
UILayerName.top = "Top"

---UI层级容器
local layer = {} ---@type table<string, UnityEngine.RectTransform>


local LAYER_BASE_GAP = 3000
---初始化UI层级
---@param UICanvas UnityEngine.GameObject
function UIMgr.InitLayer(UICanvas)
    local index = 0
    local canvas = GetComponent.Canvas(UICanvas)
    --canvas.renderMode = UnityEngine.RenderMode.

    local addNewLayer = function(name)
        local layerGo = GameObject.New(name)
        local rect = AddOrGetComponent(layerGo, UnityEngine.RectTransform) ---@type UnityEngine.RectTransform
        layerGo.transform:SetParent(UICanvas.transform)
        layerGo.transform.localPosition = Vector3.zero

        rect.anchorMax = Vector2.one
        rect.anchorMin = Vector2.zero
        rect.offsetMin = Vector2.zero
        rect.offsetMax = Vector2.zero
        if canvas.renderMode == UnityEngine.RenderMode.ScreenSpaceCamera then
            local uiCamera = GetComponent.Canvas(Game.UICanvas).worldCamera
            local baseZ = math.abs(uiCamera.transform.localPosition.z)
            rect.anchoredPosition3D = Vector3.New(rect.anchoredPosition3D.x, rect.anchoredPosition3D.y, index * LAYER_BASE_GAP)
            local scale = (index * LAYER_BASE_GAP + baseZ)/baseZ
            index = index + 1
            rect.localScale = Vector3.one * scale
            rect:SetSiblingIndex(1)
        else
            rect.localScale = Vector3.one
            rect:SetAsFirstSibling()
        end
        layer[name] = rect
    end
    addNewLayer(UILayerName.top)
    addNewLayer(UILayerName.guide)
    addNewLayer(UILayerName.alert)
    addNewLayer(UILayerName.uiTop)
    addNewLayer(UILayerName.panel)
    addNewLayer(UILayerName.ui)
    addNewLayer(UILayerName.scene)
end

---获取UI层级
---@return UnityEngine.RectTransform
function UIMgr.GetLayer(name)
    return layer[name]
end

return UIMgr