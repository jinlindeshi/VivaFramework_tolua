---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by likai.
--- DateTime: 2024/6/20 17:03
--- 主界面玩家信息
---@class PlayerInfo:LuaObj
---@field New fun():PlayerInfo
local PlayerInfo = class("PlayerInfo",LuaObj)

function PlayerInfo:Ctor()
    PlayerInfo.super.Ctor(self, "Prefabs/Common/PlayerInfo.prefab", nil, Constants.LAYER_UI)
    GetComponent.RectTransform(self.gameObject).anchoredPosition = Vector2.zero
    self.copper = self.transform:Find("copper").gameObject
    self.food = self.transform:Find("food").gameObject
    self.wood = self.transform:Find("wood").gameObject
    self.gold = self.transform:Find("gold").gameObject
    self.tieqi = self.transform:Find("tieqi").gameObject

    self.activityListTra = self.transform:Find("activityList")
    self.ordainBtn = self.transform:Find("ordainBtn").gameObject

    self.nativeColor = GetComponent.TextMeshProUGUI(self.wood.transform:Find("lb").gameObject).color
    --self.copperLb = GetComponent.TextMeshProUGUI(self.copper.transform:Find("lb").gameObject)
    --self.foodLb = GetComponent.TextMeshProUGUI(self.food.transform:Find("lb").gameObject)
    --self.goldLb = GetComponent.TextMeshProUGUI(self.gold.transform:Find("lb").gameObject)
    self:ChangeValue(Constants.RES_COPPER, 10000, true)
    self:ChangeValue(Constants.RES_FOOD, 10000, true)
    self:ChangeValue(Constants.RES_WOOD, 10000, true)
    self:ChangeValue(Constants.RES_GOLD, 10000, true)
    self:ChangeValue(Constants.RES_TIEQI, 20, true)

    Happy.BtnClickDownUP(self.ordainBtn, function()
        require("Module.Demo.OrdainPanel").New(self.ordainBtn.transform.position)
    end)
end

function PlayerInfo:ChangeValue(resName, changeValue, noTween)
    local curValue = UserData[resName]
    --print("你妹啊~", resName, curValue)
    UserData[resName] = curValue + changeValue
    local tran = self.transform:Find(resName)
    local lb = GetComponent.TextMeshProUGUI(tran:Find("lb").gameObject)
    if noTween == true then
        lb.text = UserData[resName]
        return
    end
    if self[resName.."Tween"] then
        self[resName.."Tween"]:Kill()
    end
    tran:DOScale(Vector3.one * 1.3, 0.1)
    lb:DOKill(true)
    lb.color = self.nativeColor
    if changeValue < 0 then
        lb:DOColor(Color.red, 0.3):SetLoops(2, DOTWEEN_LOOP_TYPE.Yoyo)
    else
        lb:DOColor(Color.green, 0.3):SetLoops(2, DOTWEEN_LOOP_TYPE.Yoyo)
    end
    self[resName.."Tween"] = Happy.DOTweenFloat(curValue, UserData[resName], changeValue/1000, function(value)
        lb.text = math.floor(value)
    end, function()
        lb.text = UserData[resName]
        tran:DOScale(Vector3.one, 0.1)
        self[resName.."Tween"] = nil
    end)
end

return PlayerInfo